# 스위치 Switch

![image](https://github.com/CodeSquad-2023-BE-Study/Network-Study/assets/103120173/79ba13f9-4bb2-4bf6-8566-a7961f1ff681)

<aside>
💡 L2 장치로 데이터 링크 계층에서 동작한다. 레이어 2 스위치 혹은 스위칭 허브라고 불린다.

</aside>

- 허브와 비슷하게 생긴 스위치

![image](https://github.com/CodeSquad-2023-BE-Study/Network-Study/assets/103120173/608781ed-60ac-44d5-9843-6d6ed51611fb)

- 허브와의 가장 큰 차이점은 `MAC 주소 테이블` 이다.

## Mac 주소 테이블

- 일종의 데이터 베이스
- 스위치의 포트 번호, 해당 포트에 연결되어 있는 MAC 주소가 등록되어있다.
- 허브와는 달리 스위치는 MAC주소 테이블을 학습할 수 있다.
    - 한번이라도 패킷을 송신하면 해당 기기의 MAC 주소가 주소표에 등록된다.
    - 패킷을 수신했을 때, MAC 주소를 조사하고 수신 입력 포트와 하나의 세트로 주소표에 등록

![image](https://github.com/CodeSquad-2023-BE-Study/Network-Study/assets/103120173/bd888510-9f5a-4607-b230-993310f5408f)

- 패킷을 중계할 때, MAC 주소표의 내용을 갱신한다.
- 폐기하는 상황
    - 스위칭 허브는 패킷 수신 포트와 송신 포트가 같을 경우 패킷을 중계하지 않고 폐기한다.

# 라우터 router

![image](https://github.com/CodeSquad-2023-BE-Study/Network-Study/assets/103120173/43ea6f76-2760-4115-9418-871eb1ddd434)

<aside>
💡 라우터의 본연의 역할은 다른 네트워크 사이를 연결해주는 것. 3계층인 네트워크 계층에 해당하는 네트워크 기기이다.

</aside>

- 중계 대상을 등록한 표를 보고 패킷을 어디로 중계해야할 지 판단하는 부분이 공통이다.
    - 그러나 차이점으로 라우터의 바탕은 IP, 스위칭허브의 바탕은 이더넷이다.
- 목적지 IP 주소까지 어떤 경로로 데이터를 보낼지 결정한다. 이를 라우팅 routing이라고 한다.
- 라우팅 테이블상의 정보를 기반으로 라우팅한다.
    - 목적지 네트워크 주소
    - 목적지 네트워크로 패킷을 보낼 자신의 인터페이스
    - 목적지 네트워크에 패킷을 보낼 때의 다음 라우터 주소
    - 목적지까지의 최적 경로를 선택하기 위한 값
- 일치하는 라우팅 정복 ㅏ없을 때 할당되는 경로
    - 기본 경로를 설정해두면, 패킷을 다시 기본 경로에 보낸다.
- 기본 동작
    1. 포트 부분에서 패킷 수신
        - 통신 기술의 규칙을 따른다.
    2. 중계부분에서 받은 패킷의 IP패킷에 있는 수신처 IP주소와 중계 대상을 등록한 표를 대조하여 중계 대상 판단
    3. 중계 대상측의 포트로 패킷을 옮기고 포트 부분의 하드웨어 규칙에 따라 패킷 송신 동작 실행
        - 포트 부분에 의뢰하여 패킷을 송신

## 경로표, 라우팅 테이블

![image](https://github.com/CodeSquad-2023-BE-Study/Network-Study/assets/103120173/16c38bc6-15ce-4d79-a8bd-422351cd0fdc)

- 넷마스크를 이용하여 네트워크 번호의 비트 수를 판단한다.
- 그리고 네트워크 번호 부분만 조사.
- 주소 집약을 이용하여 경로표에 등록하는 건수를 줄일 수 있다.
    - 수신처의 IP가 비슷할 때 서브넷이 있다는 것으로 간주하여 경로표에 등록
- 메트릭
    - 목적지가 가까운지, 먼지를 나타낸다.

### 경로표를 검색하여 출력 포트 발견

- 수신이 끝나면 MAC 헤더를 폐기한다.
- MAC 헤더 뒤에 있는 IP 헤더 내용으로 패킷 중계동작 시작
- 넷마스크와 비교하여 IP 주소 중에서 네트워크 번호 부분만 비교한다.
- 경로표에서 후보를 뽑는다.
    - 수신처 후보의 네트워크 번호 비트 수가 긴 것이 우선 (범위가 축소되어 더 확률이 높다.)
    - 메트릭이 작은 쪽을 중계 대상으로 선택
- 후보가 1개만 남으면 여기로 중계한다.
- 만약 해당하는 행이 하나도 없다면 패킷을 폐기하고 송신처에 ICMP메시지를 보낸다.
    - 응답 패킷을 TCP로 넘긴다.
    - 스위칭허브의 경우 모두에게 뿌리는데, 라우터는 큰 규모의 네트워크라 그냥 뿌리면 네트워크가 혼잡해진다.

 ## 라우팅 테이블에 학습시키는 방법

- 스위칭 허브랑 달리 경로표 등록/갱신 동작은 중계와 분리되어있다.

### 정적 라우팅

- 네트워크 관리자가 라우팅 테이블에 라우팅 정보를 하나하나 등록하는 방법

### 동적 라우팅

- 라우팅 정보를 다른 라우터에게 자동으로 받는 방법
- 라우팅 프로토콜 학습 방법 : 자세한건 다음에 공부해보기. 지금은 너무 복잡해서….
    - RIP, OSPF, BGP 등이 있음.
    - 디스턴스 벡터 알고리즘 (**DVR(Distance Vector Routing) 프로토콜**)
    - 링크 스테이트 알고리즘(Link State Routing Algorithm)
    - 패스 벡터 알고리즘(Path Vector Algorithm)

## L3 스위치와 라우터

- 라우터와 레이어3 스위치
    - 패킷의 전송 처리를 소프트웨어적으로 하는가, 하드웨어적으로 하는가의 차이점
    - 그러나 하드웨어적으로 전송하는 라우터도 나오면서 큰 차이점은 사라졌다.

![image](https://github.com/CodeSquad-2023-BE-Study/Network-Study/assets/103120173/7e7db274-2fa7-40d4-87e6-31b440d0b8ef)

## 라우터의 기능들

- NAT/NAPT : 일대다 주소변환
- VPN : 가상 사설 네트워크
- PPPoE :
    - PPP(Point-to-Point Protocol) over Etherne
        
        [PPPoE의 의미와 원리](https://nordvpn.com/ko/blog/what-is-pppoe/)
        
    - 가정내 LAN에 접속된 PC나 라우터 등의 기기와 ISP 내에 설치된 통신 기기사이에 접속 수단
- 패킷 필터링
    - MAC 헤더 IP헤더, TCP헤더에 기록되어 있는 내용을 조사하여 사전 설정한 조건에 합치되면 중계하거나 폐기하는 동작 실행
    - 패킷의 헤더 에 들어있는 정보를 기반으로 필터링 처리 실행
 
- 라우터를 이중화하여 네트워크 신뢰도를 높일 수 있다.
    
![image](https://github.com/CodeSquad-2023-BE-Study/Network-Study/assets/103120173/7f4301ca-cc27-433f-b9bd-a9b3503e23a0)
